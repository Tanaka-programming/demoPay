<!-- ============================================================================================== -->
<!-- â‘  PAYPAYâ€‘DEMO.HTML                                                                              -->
<!-- ============================================================================================== -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PayPay Simulator</title>
  <style>
    /* ===== è¦‹ãŸç›®ã‚’å°‘ã—æ•´ãˆã‚‹ã ã‘ã® CSS ===== */
    body {
      font-family: system-ui, sans-serif;
      background:#f7f7f7;
      margin:0;
      display:grid;
      place-items:center;
      height:100vh;
    }
    .card {
      background:#fff;
      padding:2rem;
      border-radius:1rem;
      box-shadow:0 4px 12px rgba(0,0,0,.1);
      width:100%;
      max-width:480px;
    }
    label{font-weight:600;margin-top:1rem;display:block;}
    input[type="text"]{width:100%;padding:.5rem .75rem;margin-top:.25rem;border:1px solid #ccc;border-radius:.5rem;font-size:1rem;}
    input[type="checkbox"]{margin-right:.4rem;}
    button{
      width:100%;
      margin-top:.75rem;
      padding:.6rem;
      background:#00b900;
      color:#fff;
      font-size:.95rem;
      font-weight:700;
      border:none;
      border-radius:.65rem;
      cursor:pointer;
      transition:opacity .2s;
    }
    button:hover{opacity:.85;}
    button.problem{background:#d9534f;}   /* èµ¤ = ã‚ã–ã¨å•é¡Œã‚’èµ·ã“ã™ */
    button.line   {background:#4285f4;}   /* é’ = LINE ã‚¹ã‚­ãƒ¼ãƒ  */
    .link-out{margin-top:1rem;font-size:.85rem;word-break:break-all;}
    hr{margin:1.5rem 0;border:none;border-top:1px dashed #ccc;}
  </style>
</head>
<body>
  <div class="card">
    <h1>PayPay Simulator</h1>
    <p>ç–‘ä¼¼æ±ºæ¸ˆ â†’ LIFF B ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’æ¤œè¨¼ã—ã¾ã™ã€‚</p>

    <!-- LIFF ID ã¨æˆ»ã‚Šå€¤ãƒ‘ã‚¹ã‚’å¤‰æ›´ã—ãŸã„å ´åˆã¯ã“ã“ã‚’ç·¨é›† -->
    <label>LIFF ID</label>
    <input id="liffId" type="text" value="2007624426-93P1xyXj" />

    <label>æˆ»ã‚Šå€¤ãƒ‘ã‚¹ (æœªã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰)</label>
    <input id="resultPath" type="text" value="/RSV_P/pxx/ClientService?AppSessionID=202506231800-TEST&status=success" />

    <!-- ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã™ã¨ã€Œãƒªãƒ³ã‚¯ã ã‘ç”Ÿæˆ â†’ è‡ªåˆ†ã§æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ãã€ãƒ¢ãƒ¼ãƒ‰ -->
    <label style="margin-top:1.25rem"><input id="autoJump" type="checkbox" checked> è‡ªå‹•ã§é·ç§»ã™ã‚‹ï¼ˆNetwork è§£æã—ãªã„å ´åˆã®ã¿æ¨å¥¨ï¼‰</label>

    <!-- https ç‰ˆï¼šUniversal Link â†’ LINE â†’ å¤–éƒ¨ãƒ–ãƒ©ã‚¦ã‚¶ç”¨ ãƒ†ã‚¹ãƒˆ -->
    <hr>
    <h3>ğŸ”µ å¤–éƒ¨ãƒ–ãƒ©ã‚¦ã‚¶ (https) çµŒç”±</h3>
    <button class="problem" onclick="goProblem('https')">?redirect_uri= ï¼ˆäºŒé‡ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼‰</button>
    <button onclick="goFragment('https')">#redirect_uri= ï¼ˆãƒãƒƒã‚·ãƒ¥æ¨å¥¨ï¼‰</button>

    <!-- line://app ç‰ˆï¼šç›´æ¥ LINE ã‚¢ãƒ—ãƒªã‚’é–‹ããƒ‘ã‚¿ãƒ¼ãƒ³ â†’ ã‚ˆã‚Šæœ¬ç•ªã«è¿‘ã„æŒ™å‹• -->
    <hr>
    <h3>ğŸŸ¢ LINE ã‚¢ãƒ—ãƒªå†… (line://) ç›´é€š</h3>
    <button class="problem line" onclick="goProblem('line')">?redirect_uri= ï¼ˆLINE Schemeï¼‰</button>
    <button class="line" onclick="goFragment('line')">#redirect_uri= ï¼ˆLINE Schemeï¼‰</button>

    <!-- ç”Ÿæˆã•ã‚ŒãŸãƒªãƒ³ã‚¯ã¨ã€Œã‚³ãƒ”ãƒ¼ã€æ“ä½œã‚’è¡¨ç¤º -->
    <div id="linkArea" class="link-out"></div>
    <p style="font-size:.8rem;color:#666;margin-top:.5rem;">â€» Network ã‚’å–ã‚ŠãŸã„å ´åˆã¯ã€Œè‡ªå‹•ã§é·ç§»ã™ã‚‹ã€ã®ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã—ã€<br>ç”Ÿæˆãƒªãƒ³ã‚¯ã‚’ <b>å³ã‚¯ãƒªãƒƒã‚¯â†’æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã</b> å¾Œã« DevTools ã§ Preserve Log ã‚’æœ‰åŠ¹åŒ–ã—ã¦ãã ã•ã„ã€‚</p>
  </div>

  <script>
    /* ========== å¤‰æ•°å–å¾— ========== */
    const liffInput = document.getElementById('liffId');      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã§ãã‚‹ LIFF ID
    const pathInput = document.getElementById('resultPath');  // æˆ»ã‚Šå€¤ãƒ‘ã‚¹
    const linkArea  = document.getElementById('linkArea');    // ç”Ÿæˆãƒªãƒ³ã‚¯ã‚’è¡¨ç¤ºã™ã‚‹å ´æ‰€

    /*
      buildLink()
      ----------------------------------------------------------------------
      kind   : "https" ã¾ãŸã¯ "line"
      pattern: (baseURL, path) => å®Œæˆ URL ã‚’è¿”ã™é–¢æ•°
      1. å…¥åŠ›å€¤ã‚’å–å¾—ã—ã€line:// or https:// ã®ãƒ™ãƒ¼ã‚¹ URL ã‚’ä½œæˆ
      2. pattern ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§å…·ä½“çš„ãª Deeplink ã‚’ç”Ÿæˆ
    */
    function buildLink(kind, pattern){
      const id   = liffInput.value.trim();   // å‰å¾Œç©ºç™½ã‚’å‰Šé™¤
      const path = pathInput.value.trim();
      if(!id || !path){
        alert('LIFF ID ã¨ æˆ»ã‚Šå€¤ãƒ‘ã‚¹ã‚’å…¥åŠ›ã—ã¦ä¸‹ã•ã„');
        return null;
      }
      const base = kind==='line' ? `line://app/${id}` : `https://liff.line.me/${id}`;
      return pattern(base, path);
    }

    // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼ç”¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    function copyToClip(link){
      navigator.clipboard.writeText(link)
        .then(()=>alert('ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ\nåˆ¥ãƒ–ãƒ©ã‚¦ã‚¶/ç«¯æœ«ã§è²¼ã‚Šä»˜ã‘ã¦æ¤œè¨¼ã—ã¦ä¸‹ã•ã„'));}

    /*
      setLinks()
      ------------------------------------------------------------------
      1. linkArea ã«ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ãª HTML ã‚’ç”Ÿæˆ
      2. autoJump ãŒ ON ã®å ´åˆã®ã¿ location.href = link ã§å³é·ç§»
    */
    function setLinks(link){
      linkArea.innerHTML = `
        <b>ç”Ÿæˆãƒªãƒ³ã‚¯:</b><br>
        <a href="${link}" target="_blank">${link}</a><br>
        <a href="#" onclick="copyToClip('${link}');return false;">ã‚³ãƒ”ãƒ¼</a>`;

      // è‡ªå‹•é·ç§»ãƒ•ãƒ©ã‚°
      const auto = document.getElementById('autoJump').checked;
      if(auto) location.href = link;
    }

    /*
      goProblem() / goFragment()
      --------------------------------------------------------------
      kind å¼•æ•°ã§ "https" or "line" ã‚’åˆ‡ã‚Šæ›¿ãˆ â†’ buildLink ã«æ¸¡ã™
      ?redirect_uri= ç‰ˆã¯ encodeURIComponent() ã§ 1å›ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
      #redirect_uri= ç‰ˆã¯ *æœªã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰*ï¼ˆäºŒé‡ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’é¿ã‘ã‚‹ï¼‰
    */
    function goProblem(kind){
      const link = buildLink(kind, (base, path) => `${base}?redirect_uri=${encodeURIComponent(path)}`);
      if(link) setLinks(link);
    }
    function goFragment(kind){
      const link = buildLink(kind, (base, path) => `${base}#redirect_uri=${path}`);
      if(link) setLinks(link);
    }
  </script>
</body>
</html>
